
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yurt Rehberi (Debug Modu)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding: 40px 15px; }
        .yurt-kart-container { display: flex; justify-content: center; width: 100%; margin-bottom: 30px; }
        .card { border: none; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 900px; }
        .harita-konteyner { width: 100%; height: 100%; min-height: 250px; background-color: #eee; }
        iframe { width: 100%; height: 100%; border: 0; min-height: 250px; }
    </style>
</head>
<body>

<div class="container text-center">
    <h1 class="fw-bold mb-4">üè† Yurt Rehberi</h1>
    
    <div class="row justify-content-center mb-5">
        <div class="col-md-6">
            <div class="card p-4 shadow-sm">
                <label class="form-label fw-bold">√úniversitenizi Se√ßin</label>
                <select id="okulSecimi" class="form-select form-select-lg" onchange="yurtlariListele()">
                    <option value="">Veriler y√ºkleniyor...</option>
                </select>
            </div>
        </div>
    </div>

    <div id="yurtListesi" class="row"></div>
</div>
<script>
    let GLOBAL_DATA = null;
    const API_URL = "https://script.google.com/macros/s/AKfycbyfew3KVRPYyEBfFVwS5hHR_PIWF694Ycspt-jwSjFogbphbq1Cvt_IJ4dDpHAuXAQ/exec";

    window.onload = function() {
        console.log("1. ADIM: Veri √ßekiliyor...");
        fetch(API_URL, { redirect: 'follow' })
            .then(res => res.json())
            .then(data => {
                console.log("2. ADIM: Veri geldi:", data);
                GLOBAL_DATA = data;
                verileriDoldur(data);
            });
    };

    function verileriDoldur(data) {
        const select = document.getElementById("okulSecimi");
        select.innerHTML = '<option value="">L√ºtfen se√ßiniz...</option>';
        data.okulListesi.slice(1).forEach((okul, index) => {
            console.log(`Dropdown'a ekleniyor: ID=${okul[0]}, Ad=${okul[1]}`);
            let opt = document.createElement("option");
            opt.value = okul[0].toString().trim();
            opt.text = okul[1].toString().trim();
            select.appendChild(opt);
        });
    }

    function yurtlariListele() {
        const secilenID = document.getElementById("okulSecimi").value;
        console.log("--- Fƒ∞LTRELEME BA≈ûLADI ---");
        console.log("Aranan Okul ID'si:", secilenID);

        const listeDiv = document.getElementById("yurtListesi");
        listeDiv.innerHTML = "";

        if (!secilenID || !GLOBAL_DATA) return;

        const yurtlar = GLOBAL_DATA.yurtListesi;

        for (let i = 1; i < yurtlar.length; i++) {
            const yurt = yurtlar[i];
            
            // Vƒ∞RG√úLL√ú YAPIYI BURADA KONTROL EDƒ∞YORUZ
            // yurt[0] i√ßeriƒüi √∂rn: "101, 102, 103"
            const hamH√ºcreVerisi = yurt[0].toString();
            const idDizisi = hamH√ºcreVerisi.split(',').map(item => item.trim());
            
            console.log(`Yurt: ${yurt[1]} | H√ºcredeki ID'ler:`, idDizisi);

            // Klasik y√∂ntemle kontrol:
            let uygunMu = false;
            for(let j = 0; j < idDizisi.length; j++) {
                if(idDizisi[j] === secilenID) {
                    uygunMu = true;
                    break;
                }
            }

            if (uygunMu) {
                console.log("E≈üle≈üme bulundu! Yurt ekleniyor:", yurt[1]);
                const yurtAd = yurt[1];
                const haritaLink = yurt[2];
                const adres = yurt[3];
                const sorumlu = yurt[4];
                const telefon = yurt[5];
                
                // Embed linki (Daha g√ºvenli format)
                const embedUrl = `https://maps.google.com/maps?q=${encodeURIComponent(yurtAd + ' ' + adres)}&t=&z=15&ie=UTF8&iwloc=&output=embed`;

                const html = `
                    <div class="col-12 yurt-kart-container">
                        <div class="card shadow">
                            <div class="row g-0">
                                <div class="col-md-5">
                                    <div class="harita-konteyner">
                                        <iframe src="${embedUrl}"></iframe>
                                    </div>
                                </div>
                                <div class="col-md-7 text-start p-4">
                                    <h4 class="fw-bold">${yurtAd}</h4>
                                    <p class="mb-1">üìç ${adres}</p>
                                    <p class="mb-1">üë§ Sorumlu: ${sorumlu}</p>
                                    <p class="mb-3">üì± Tel: ${telefon}</p>
                                    <a href="tel:${telefon}" class="btn btn-success">Hemen Ara</a>
                                    <a href="${haritaLink}" target="_blank" class="btn btn-outline-primary">Haritada G√∂r</a>
                                </div>
                            </div>
                        </div>
                    </div>`;
                listeDiv.innerHTML += html;
            }
        }
    }
</script>
</body>
</html>